# git コマンドの基本操作を覚える

チーム開発はもちろん、個人で開発する場合でもソースコードのバージョン管理は重要です。適切にバージョン管理システムを活用すれば、快適で効率の良いプログラミングが可能になります。

php-abc-quests では、[Git](http://ja.wikipedia.org/wiki/Git) というバージョン管理システムを使いながら課題を進めていきます。

Git の操作は CLI 上で `git` コマンドを使って行います。
操作に慣れていない方は Git の概念や基本的なコマンドの使用方法などについてここで理解しておきましょう。

## 用語を覚える

まずは以下の基本的な用語の意味や概念について理解しましょう。

* リポジトリ
* リモートリポジトリ
* ローカルリポジトリ
* プッシュ（push）
* プル（pull）
* クローン（clone）
* コミット（commit）
* ワークツリーとインデックス

### リポジトリ

Git はバージョン管理システムなので、ファイルの変更履歴の情報をどこかに蓄積しておくことになります。
この、情報を蓄積しておく場所のことを「リポジトリ」と言います。

### リモートリポジトリ

専用のサーバ上に設置されているリポジトリを「リモートリポジトリ」と呼びます。

複数人で開発する場合などは、リモートリポジトリをチームで共有して全員の行った変更を一箇所で管理しながら開発を進めます。

### ローカルリポジトリ

自分の開発用 PC 上に作ったリポジトリのことを「ローカルリポジトリ」と呼びます。

普段の作業はローカルリポジトリ上で行い、ある程度ローカルリポジトリに作業履歴が溜まったら、それをリモートリポジトリにアップロードする、という流れで開発を進めます。

### プッシュ（push）

ローカルリポジトリからリモートリポジトリに作業履歴をアップロードすることを、「プッシュする」と言います。

実際の操作では、`git push` コマンドを使用します。

### プル（pull）

逆に、リモートリポジトリからローカルリポジトリに作業履歴をダウンロードすることを「プルする」と言います。

リモートリポジトリの方がローカルリポジトリよりも作業が進んでいる場合は、まずローカルリポジトリの状態をリモートリポジトリと同じにしてから作業を始める必要があります

複数人で開発している場合はもちろん、個人開発の場合でも複数の PC で開発している場合などはローカルよりもリモートの方が作業が進んでいる場合があるので、作業を開始する前は念のため一度プルするようにするとよいです。

実際の操作では `git pull` コマンドを使用します。

### クローン（clone）

リモートリポジトリの作業内容をローカルリポジトリにプルするには、ローカルリポジトリとリモートリポジトリの「紐付け」がされている必要があります。

この紐付けを行うために、開発を始めるときに一度だけ「クローン」という操作が必要になります。

通常、開発を始めるときには、

1. まずサーバ上に空のリモートリポジトリを作る
2. その後ローカルリポジトリを作る
3. ローカルリポジトリとリモートリポジトリの紐付けを行う
4. リモートリポジトリからプル（「空」という状態を同期）
5. 開発開始

という作業を行うのですが、クローンは「既存のリモートリポジトリと同じ内容でローカルリポジトリを作る」という操作なので、クローンを行うだけで 2 〜 4 を一気に実行できます。

実際の操作では `git clone` コマンドを使用します。

> 2 や 3 を別々に行うためのコマンドもありますが、慣れてくるまでは知らなくても特に困らないので、今は覚えなくて大丈夫です。

### コミット（commit）

これまで「作業履歴」や「変更履歴」といった表現を使ってきましたが、Git リポジトリ上での変更履歴の情報は、「コミット」という単位で記録されています。

コミットを記録する操作のことを「コミットする」と言います。コミットを実行すると、前回コミットしたときの状態から現在の状態までの差分が一つのコミットとしてリポジトリに記録されます。

コミットを積み重ねながら開発を進めていくと、リポジトリ上には今までのコミットが時系列に並んだ状態になるので、過去のある時点の状態に戻すというような操作が簡単に行えます。
時系列に積み重なったコミットの履歴のことを「コミットログ」と呼んだりします。

実際の操作では `git commit` コマンドを使用します。

### ワークツリーとインデックス

Git では、Git の管理下に置かれた、あなたが実際に作業しているディレクトリのことを「ワークツリー」と呼びます。

そして、Git ではワークツリーとリポジトリの間に「インデックス」という擬似的な空間が存在します。
インデックスは、リポジトリに変更をコミットする準備をするための場所です。

実は、ワークツリー上でファイルに変更を加えてすぐにコミットを実行しようとしても、「コミットするものが何もないよ」と怒られてコミットできません。
ワークツリー上で行った変更をコミットするには、変更内容を一度インデックスに追加してからコミットを実行する必要があります。

このように、ワークツリーとリポジトリの間にインデックスを挟むことで、ワークツリー内の不要なファイル（バージョン管理したくないファイル）を含めずにコミットしたり、たくさん行った変更のうちの一部だけをコミットしたりといったことが可能になります。

実際の操作では、`git add` コマンドを使用してワークツリーの変更をインデックスに追加します。

## 主な git コマンドの実際の使用方法

### git clone

既存のリモートリポジトリをローカルにクローンしてくるには、`git clone` コマンドにパラメータとしてリモートリポジトリの URL を渡します。

実行すると、今いる場所の直下に新しいディレクトリが作られ、そこがリモートと紐付け済みのローカルリポジトリになります。

```bash
$ cd ~/workspace
$ git clone https://github.com/qckanemoto/php-abc-quests.git
$ cd php-abc-quests
```

### git add

ワークツリーで変更した内容をインデックスに追加するには、`git add` コマンドにパラメータとして追加したいファイルのパスを渡します。

```bash
$ git add test.php
```

ファイルのパスではなくディレクトリのパスを渡せば、そのディレクトリ配下の全ての変更をインデックスに追加できます。

```bash
$ git add test/
```

カレントディレクトリを表す `.` をディレクトリパスとして渡せば、ワークツリーの全ての変更をインデックスに追加することができます。通常はこれを一番よく使います。

```bash
$ git add .
```

### git commit

インデックスに追加されている変更をローカルリポジトリにコミットするには、`git commit` コマンドを使います。

コミットには常に「コミットメッセージ」（「◯◯の機能を追加した」などの、変更の意図が分かるように残しておくメッセージ）を付加する必要があるため、以下のように `git commit` コマンドを `-m` オプション付きで実行します。

```bash
$ git commit -m "◯◯機能を追加した"
```

> `git commit` コマンドをパラメータなしで実行するとコミットメッセージを書き込む画面にるのですが、日本語のメッセージが文字化けしないようにするためには事前に設定が必要だったりと少し使いこなすのが面倒なので、慣れるまでは `-m` 付きで使うようにしましょう。

### git push

ローカルリポジトリに追加されたコミットをリモートリポジトリにプッシュするには、`git push` コマンドを使います。

事前にリモートリポジトリとの紐付けが済んでいれば、「どのリモートリポジトリにプッシュするか」などを指定する必要も特にありません。

```bash
$ git push
```

> リモートリポジトリへの書き込みに権限が必要な場合は、`git push` 実行時にユーザ名とパスワードの入力が求められます。

### git pull

リモートリポジトリにしかないコミットをローカルリポジトリにプルしてくるには、`git pull` コマンドを使います。

プッシュと同様に、リモートとローカルの紐付けが済んでいれば、特にパラメータは必要ありません。

```bash
$ git pull
```

### git status

`git status` は、現在のローカルリポジトリの状態（ワークツリーとインデックスの状態）を表示してくれるコマンドです。

Git を用いた開発ではとても頻繁に使うコマンドなので、覚えておいてください。

```bash
$ git status
```

## 参考リンク

Git についてより詳しく理解したい方のために、おすすめのサイトをリンクしておきます。
現代のプログラマには Git は必須スキルなので、ぜひ積極的に学習してくみてください！

| サイト名 | 内容 |
| --- | --- |
| [サルでもわかるGit入門](http://www.backlog.jp/git-guide/) | 大変分かりやすく丁寧に書かれた Git の入門サイトです。 |
| [Learn Git Branching](http://k.swd.cc/learnGitBranching-ja/) | 実際にコマンドを打って課題をクリアしていく Git の練習サイトです。Rebase ぐらいまでクリアすれば Git の性質についてかなり理解できるようになると思います。 |
